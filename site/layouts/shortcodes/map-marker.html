<!-- Bring everything into variables so we don't have to worry abouut them later -->
{{- $lat := .Get "lat" | default "" -}}
{{- $long := .Get "long" | default "" -}}
{{- $address := .Get "address" | default "" -}}
{{- $title := .Get "title" | markdownify | default "" -}}
{{- $description := .Inner | markdownify | default "" -}}

<!-- Next, evaluate what we're searching for. Lat/long takes priority over address, since we need to geocode those -->
{{ $latLongRegex := `^-?\d+(\.\d+)?$` }}
{{ $location := "" }}
{{ if and $lat $long }}
    {{ if and (eq (len (findRE $latLongRegex $lat)) 0) (eq (len (findRE $latLongRegex $long)) 0) }}
        {{ errorf (print "Invalid map marker command: Lat " $lat " and long " $long " are malformed") }}
    {{ end }}
{{ else if $address }}
    {{ warnf "Please consider changing this address to a latitude/longitude pair instead, as addresses will need to be looked up in Google Maps (and count against usage quotas)." }}
{{ end }}

<!-- Honestly I don't know how I didn't think of this before. I honestly feel quite stupid right now. -->
<!-- Create a new, hidden HTML element  with a particular class that will be checked by the map script on page load. Include the requisite data in data-* tags. HTML content should be rendered into divs and fetched accordingly. -->
<div class="map-marker-data hidden" data-lat={{- $lat -}} data-long={{- $long -}} data-address="{{- $address -}}">
    <div class="title">{{ $title }}</div>
    <div class="description">{{ $description }}</div>
</div>